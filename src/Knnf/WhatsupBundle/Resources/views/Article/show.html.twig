{% extends "KnnfWhatsupBundle:Layout/front:index.html.twig" %}

{% block content %}
    <div class="row">

        {# partie gauche de la page article #}
        <div class="col-md-8 whatsup-singlearticle-left">
            {# Article #}
            <div class="whatsup-article">
                <h3 class="whatsup-article-title">{{ article.title }}<a id="signalement" class="btn btn-danger btn-mini">signaler</a><a id="signalement" class="btn btn-primary btn-mini" onclick="addLike({{ article.id }})">Like</a></h3>
                <div class="whatsup-article-body">
                    {{ article.content | raw }}
                </div>
            </div>
            <div class="whatsup-article-author">
                <h5>Profil r√©dacteur</h5>
                <div class="row">
                    <div class="col-md-2">
                        {#<img src="{{ (article.user.photo|length  > 0) ? asset('bundles/knnfwhatsup/img/avatar/') ~ article.user.photo  : asset('bundles/knnfwhatsup/img/default-avatar.png') }}" height="92px" />#}
                        <img src="{{asset('bundles/knnfwhatsup/img/default-avatar.png') }}" height="92px" />
                    </div>
                    <div class="col-md-10">
                        <div class="whatsup-username">{#article.user.username#} toto</div>
                        <div>{{nbcomments}} commentaire</div>
                        <div id="like">{{nblike}} like</div>
                       
                    </div>
                    
                </div>
            </div>
             <div>
                <form >
                    <label for="name">Commentaire</label>
                    <textarea class="form-control" rows="3" name="commentaire"></textarea>
                    <button type="submit" class="btn btn-default" onclick="addComments({{article.id}})">Commentaire</button>     
                </form>
            </div>
            <div class="whatsup-article-comments">
                <h5>Commentaires</h5>
                {{ render(controller("KnnfWhatsupBundle:Article:comment", {"article_id": article.id} )) }}
            </div>
        </div>

        {# partie droite de la page article #}
        <div class="col-md-4">
            <div>
                <h4>Articles relatifs</h4>
                {{ render(controller("KnnfWhatsupBundle:Article:categoryArticles", {"category":article.category, "limit":3} )) | raw }}

            </div>
            <div>
                <h4>Derniers articles de l'auteur</h4>
                {{ render(controller("KnnfWhatsupBundle:Article:authorArticles", {"author": article.user, "limit":3} )) }}

            </div>
        </div>

    </div>

<div id="dialog-form" title="Signalement">
<form>
<fieldset>
<label for="name">Raison du signalement</label>
<input type="text" name="description" id="description" class="text ui-widget-content ui-corner-all">
</fieldset>
</form>
</div>
        {% block javascripts %}
            <script>

                $( document ).ready(function() {
                    console.log( "ready!" );
                    $( "#signalement" ).click(function() {
                        $( "#dialog-form" ).dialog( "open" );
                    });
                    
                });

                function addSignalement(id)
                {
                    $.ajax({
                        url: "{{ path('annotation_add')}}",
                        type: "post",
                        data: {
                            article_id: id,
                            description: $('[name="description"]').val(),
                            type: 'signalement',
                        },
                        success: function(){
                            alert("success");
                            //window.location.reload();
                        },
                        error:function(){
                            alert("failure");
                        }
                    });
                };

                function addComments(id)
                {
                    $.ajax({
                        url: "{{ path('annotation_add')}}",
                        type: "post",
                        data: {
                            article_id: id,
                            description: $('[name="commentaire"]').val(),
                            type: 'comments',
                        },
                        success: function(){
                            alert("success");
                            window.location.reload();
                        },
                        error:function(){
                            alert("failure");
                        }
                    });
                };

                function addLike(id)
                {
                    $.ajax({
                        url: "{{ path('annotation_add')}}",
                        type: "post",
                        data: {
                            article_id: id,
                            description: $('[name="description"]').val(),
                            type: 'like',
                        },
                        success: function(data){
                            //alert(data);
                            $('#like').html(data+" likes")
                            //window.location.reload();
                        },
                        error:function(){
                            alert("failure");
                        }
                    });
                };



                $( "#dialog-form" ).dialog({
                    autoOpen: false,
                    height: 300,
                    width: 350,
                    buttons: {
                        Cancel: function() {
                            $( this ).dialog( "close" );
                        },
                        Submit: function() {
                            addSignalement({{article.id}});
                        }
                    }
                });

                 
            </script>
        {% endblock %}
{% endblock %}
